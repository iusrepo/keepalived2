From e2562e4bc40e6092d07e0e2ad8d43fdf9d79e463 Mon Sep 17 00:00:00 2001
From: Alexandre Cassen <acassen@gmail.com>
Date: Tue, 7 Jan 2014 08:37:22 +0100
Subject: [PATCH 3/7] libipvs: libnl-3 include fix

when libnl-3 is present use proper include path. On most system libnl-3
include path is /usr/include/libnl3.
---
 configure                          | 4 ++++
 configure.in                       | 3 +++
 keepalived/libipvs-2.6/Makefile.in | 2 +-
 3 files changed, 8 insertions(+), 1 deletion(-)

diff --git a/configure b/configure
index be6574e..90cca7d 100755
--- a/configure
+++ b/configure
@@ -622,6 +622,7 @@ ac_includes_default="\
 ac_subst_vars='LTLIBOBJS
 LIBOBJS
 VRRP_SUPPORT
+INCLUDE_NL
 USE_NL
 IPVS_SUPPORT
 VERSION_DATE
@@ -3976,6 +3977,7 @@ if test "x$ac_cv_lib_nl_genl_3_genl_connect" = xyes; then :
         USE_NL="LIBIPVS_USE_NL"
         CFLAGS="$CFLAGS $(pkg-config libnl-genl-3.0)"
 	LIBS="$LIBS $(pkg-config --libs libnl-genl-3.0)"
+	INCLUDE_NL="-I/usr/include/libnl3"
 
 else
 
@@ -4027,6 +4029,7 @@ if test "x$ac_cv_lib_nl_nl_socket_modify_cb" = xyes; then :
         USE_NL="LIBIPVS_USE_NL"
         CFLAGS="$CFLAGS -DFALLBACK_LIBNL1"
         LIBS="$LIBS $(pkg-config --libs libnl-1)"
+	INCLUDE_NL=""
 
 else
 
@@ -4462,6 +4465,7 @@ fi
 
 
 
+
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for an ANSI C-conforming const" >&5
 $as_echo_n "checking for an ANSI C-conforming const... " >&6; }
 if ${ac_cv_c_const+:} false; then :
diff --git a/configure.in b/configure.in
index 3d4a191..364890d 100644
--- a/configure.in
+++ b/configure.in
@@ -63,6 +63,7 @@ AC_CHECK_LIB(nl-3, nl_socket_alloc,
         USE_NL="LIBIPVS_USE_NL"
         CFLAGS="$CFLAGS $(pkg-config libnl-genl-3.0)"
 	LIBS="$LIBS $(pkg-config --libs libnl-genl-3.0)"
+	INCLUDE_NL="-I/usr/include/libnl3"
       ],
       [
         AC_MSG_ERROR([libnl-3 is installed but not libnl-gen-3. Please, install libnl-gen-3.])
@@ -74,6 +75,7 @@ AC_CHECK_LIB(nl-3, nl_socket_alloc,
         USE_NL="LIBIPVS_USE_NL"
         CFLAGS="$CFLAGS -DFALLBACK_LIBNL1"
         LIBS="$LIBS $(pkg-config --libs libnl-1)"
+	INCLUDE_NL=""
       ],
       [                                                                                           
         USE_NL="LIBIPVS_DONTUSE_NL"
@@ -277,6 +279,7 @@ AC_SUBST(VERSION)
 AC_SUBST(VERSION_DATE)
 AC_SUBST(IPVS_SUPPORT)
 AC_SUBST(USE_NL)
+AC_SUBST(INCLUDE_NL)
 AC_SUBST(VRRP_SUPPORT)
 
 dnl ----[ Checks for typedefs, structures, and compiler characteristics ]----
diff --git a/keepalived/libipvs-2.6/Makefile.in b/keepalived/libipvs-2.6/Makefile.in
index 14cfa95..dfefc7d 100644
--- a/keepalived/libipvs-2.6/Makefile.in
+++ b/keepalived/libipvs-2.6/Makefile.in
@@ -1,7 +1,7 @@
 # Makefile for libipvs
 
 CC		= @CC@
-CFLAGS		= @CFLAGS@ @CPPFLAGS@ -D@USE_NL@ -Wall -Wunused
+CFLAGS		= @CFLAGS@ @CPPFLAGS@ @INCLUDE_NL@ -D@USE_NL@ -Wall -Wunused
 
 export OBJS += libipvs.a
 
-- 
1.8.1.4

